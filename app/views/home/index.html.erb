<div class="stats-bar">
  <div class="stat-item">
    <div class="stat-value"><%= @user.total_points %></div>
    <div class="stat-label">Total Points</div>
  </div>
  <div class="stat-item">
    <div class="stat-value">Level <%= @user.current_level %></div>
    <div class="stat-label">Current Level</div>
  </div>
  <div class="stat-item">
    <div class="stat-value"><%= @completed_count %>/<%= @total_lessons %></div>
    <div class="stat-label">Lessons Completed</div>
  </div>
  <div class="stat-item">
    <div class="stat-value"><%= @user.progress_percentage %>%</div>
    <div class="stat-label">Progress</div>
  </div>
</div>

<div class="card">
  <h2 style="margin-bottom: 20px; color: #667eea;">Welcome to BPMF Learning!</h2>
  <p class="lesson-content">
    Learn the phonetic alphabet used in Taiwan step by step. Each lesson teaches you a new symbol with fun, interactive exercises.
  </p>
  
  <div class="progress-bar">
    <div class="progress-fill" style="width: <%= @user.progress_percentage %>%">
      <%= @user.progress_percentage %>%
    </div>
  </div>
  
  <% if @next_lesson %>
    <div style="margin-top: 30px; text-align: center;">
      <%= link_to "Start Learning!", lesson_path(@next_lesson), class: "btn btn-success", style: "font-size: 20px; padding: 15px 30px;" %>
    </div>
  <% end %>
</div>

<div class="card">
  <h3 style="margin-bottom: 20px; color: #667eea;">Your Progress</h3>
  <div class="lesson-list">
    <% @lessons.each do |lesson| %>
      <% progress = @user.lesson_progresses.find_by(lesson: lesson) %>
      <% previous_lesson = lesson.previous_lesson %>
      <% is_locked = !lesson.first_lesson? && (!previous_lesson || !@user.lesson_progresses.find_by(lesson: previous_lesson)&.completed?) %>
      
      <div class="lesson-card <%= 'completed' if progress&.completed? %> <%= 'locked' if is_locked %>">
        <h4 style="margin-bottom: 10px;">
          Lesson <%= lesson.order %>: <%= lesson.title %>
          <% if progress&.completed? %>
            <span style="color: #48bb78;">âœ“</span>
          <% end %>
        </h4>
        <% if progress&.completed? %>
          <p style="color: #48bb78; font-size: 14px;">Completed! +<%= progress.points_earned %> points</p>
        <% elsif is_locked %>
          <p style="color: #999; font-size: 14px;">Locked - Complete previous lessons</p>
        <% else %>
          <p style="color: #667eea; font-size: 14px;">Ready to learn!</p>
        <% end %>
        <% unless is_locked %>
          <%= link_to "View Lesson", lesson_path(lesson), class: "btn", style: "margin-top: 10px; width: 100%; text-align: center;" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

